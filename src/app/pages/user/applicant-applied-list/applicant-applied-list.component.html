<ngx-spinner 
  bdColor="rgba(0, 0, 0, 0.8)"
  size="medium"
  color="#fff"
  type="ball-clip-rotate"
  [fullScreen]="true"
>
  <p style="color: white">Loading...</p>
</ngx-spinner>

<div class="applied-jobs-container" *ngIf="isAuthorized(); else unauthorizedAccess">
  <div class="header">
    <button (click)="goBack()" class="back-button">
      <i class="fas fa-arrow-left"></i> Back
    </button>
    <div class="header-content">
      <h2>Applied</h2>
      <div class="search-filters">
        <div class="search-box">
          <input type="text" [(ngModel)]="searchTerm" (keyup.enter)="onSearch()" placeholder="Search..." class="search-input">
        </div>
        <button (click)="Clear()" class="clear-btn">Clear</button>
      </div>
    </div>
    <!-- <div class="tabs">
      <button class="tab active">Actions ({{totalItems}})</button>

    </div> -->
    <!-- <div class="subtitle">Applies in last 90 days</div> -->
  </div>

  <div *ngIf="!appliedJobs || appliedJobs.length === 0" class="no-records-container">
    <div class="no-records">
      <i class="fas" [ngClass]="{'fa-search': searchTerm, 'fa-briefcase': !searchTerm}"></i>
      <p *ngIf="searchTerm">No matching jobs found</p>
      <p *ngIf="!searchTerm">You haven't applied to any jobs yet</p>

    </div>
  </div>

  <div class="jobs-list" *ngIf="appliedJobs && appliedJobs.length > 0">
    <div class="job-card" *ngFor="let application of appliedJobs">
      <div class="company-logo">{{application.job.title?.charAt(0)}}</div>
      <div class="job-content">
        <h3 class="job-title" [class.clickable]="canViewJobDetails()" (click)="canViewJobDetails() && viewJobDetails(application.job.id)">
          {{application.job.title}}
        </h3>
        <div class="company-name">{{application.job.employer}}</div>
        <div class="application-status">
          <span class="status-icon">âœ“</span>
          Applied {{application.applied_at | date:'mediumDate'}}
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalItems > itemsPerPage">
    <button 
      class="page-btn" 
      [disabled]="currentPage === 1"
      (click)="onPageChange(currentPage - 1)"
    >
      <i class="fas fa-chevron-left"></i>
    </button>

    <div class="page-numbers">
      <button 
        *ngFor="let page of paginationArray()"
        class="page-number"
        [class.active]="page === currentPage"
        (click)="onPageChange(page)"
      >
        {{ page }}
      </button>
    </div>

    <button 
      class="page-btn" 
      [disabled]="currentPage === totalPages"
      (click)="onPageChange(currentPage + 1)"
    >
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>

<ng-template #unauthorizedAccess>
  <div class="unauthorized-message">
    <i class="fas fa-lock"></i>
    <h2>Access Denied</h2>
    <p>You are not authorized to view this page. Please log in as an applicant to access your applied jobs.</p>
  </div>
</ng-template>
