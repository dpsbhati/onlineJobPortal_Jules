<div>
  <button (click)="navigate()" class="button">Back</button>
</div>
<div class="container">
  <h2>{{ isEditMode ? 'Edit jobposting' : 'Create jobposting' }}</h2>
  <form [formGroup]="jobForm" (ngSubmit)="onSubmit()" enctype="multipart/form-data">
    <div class="form-group">
      <label for="title">Job Title<span class="text-danger">*</span></label>
      <input id="title" formControlName="title" type="text" class="form-control" />
      <div *ngIf="jobForm.get('title')?.invalid && jobForm.get('title')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('title')?.errors?.['required']">Job Title is required.</small>
        <!-- <small *ngIf="jobForm.get('title')?.errors?.['minlength']">Job Ttile must be at least 2 characters.</small> -->
        <small *ngIf="jobForm.get('title')?.errors?.['pattern']">Job Ttile must contain only alphabets.</small>
        <small *ngIf="jobForm.get('title')?.errors?.['maxlength']">Job Title cannot exceed 50 characters.</small>
        <!-- <small *ngIf="jobForm.get('title')?.errors?.['minLengthWithoutSpaces']">Title must be at least 2 characters excluding spaces.</small>   -->
        <small *ngIf="jobForm.get('title')?.errors?.['minLengthWithoutSpaces']">
          Title must be at least {{ jobForm.get('title')?.errors?.['minLengthWithoutSpaces'].requiredLength }} characters excluding spaces.
        </small>
      </div>
    </div>

    <!-- <div class="form-group">
      <label for="job_type">Job Type<span class="text-danger">*</span></label>
      <input id="job_type" formControlName="job_type" type="text" class="form-control" />
      <div *ngIf="jobForm.get('job_type')?.invalid && jobForm.get('job_type')?.touched" class="text-danger">
        Job Type is required.
      </div>
    </div> -->
    <div class="form-group">
      <label for="job_type">Job Type<span class="text-danger">*</span></label>
      <select id="job_type" formControlName="job_type" class="form-control">
        <option value="">Select Job Type</option>
        <option value="Full-Time" >Full-Time</option>
        <option value="Part-Time">Part-Time</option>
        <option value="Flexible">Flexible</option>
      </select>
      <div *ngIf="jobForm.get('job_type')?.invalid && jobForm.get('job_type')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('job_type')?.errors?.['required']">Job Type is required.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="rank">Rank<span class="text-danger">*</span></label>
      <input id="rank" formControlName="rank" type="text" class="form-control" />
      <div *ngIf="jobForm.get('rank')?.invalid && jobForm.get('rank')?.touched" class="text-danger">
        rank is required.
      </div>
    </div>
    <div class="form-group">
      <label for="skills_required">Skills Required<span class="text-danger">*</span></label>
      <div class="d-flex">
        <input
          id="skills_input"
          type="text"
          class="form-control"
          placeholder="Enter a skill and press Enter"
          [(ngModel)]="newSkill"
          (keyup.enter)="addSkill()"
          [ngModelOptions]="{standalone: true}"
        />
        <button
          type="button"
          class="add-button"
          (click)="addSkill()"
          [disabled]="!newSkill.trim()"
        >
          Add Skill
        </button>
      </div>
      <ul class="list-group mt-2">
        <li
          class="list-group-item d-flex justify-content-between align-items-center"
          *ngFor="let skill of skillsArray; let i = index"
        >
          {{ skill }}
          <button
            type="button"
            class="remove"
            (click)="removeSkill(i)"
          >
            Remove
          </button>
        </li>
      </ul>
      <div *ngIf="skillsArray.length === 0 && jobForm.get('skills_required')?.touched" class="text-danger">
        <small>At least one skill is required.</small>
      </div>
      <div *ngIf="jobForm.get('skills_required')?.errors?.['minLengthSkill']" class="text-danger">
  <small>
    Each skill must be at least 
    {{ jobForm.get('skills_required')?.errors?.['minLengthSkill'].requiredLength }} 
    characters long.
  </small>
</div>
<div *ngIf="jobForm.get('skills_required')?.errors?.['maxLengthSkill']" class="text-danger">
        <small>
             Each skill cannot exceed 
             {{ jobForm.get('skills_required')?.errors?.['maxLengthSkill'].requiredLength }} 
               characters.
        </small>
          </div>

      <!-- <div *ngIf="jobForm.get('skills_required')?.errors?.['minSkills']" class="text-danger">
        <small>At least {{ jobForm.get('skills_required')?.errors?.['minSkills'].required }} skills are required.</small>
      </div> -->
      <div *ngIf="jobForm.get('skills_required')?.errors?.['maxSkills']" class="text-danger">
        <small>No more than {{ jobForm.get('skills_required')?.errors?.['maxSkills'].required }} skills are allowed.</small>
      </div>
      
    </div>
    

    <!-- <div class="form-group">
      <label for="skills_required">Skills Required<span class="text-danger">*</span></label>
      <ng-select id="skills_required" formControlName="skills_required" [items]="skillsList" bindLabel="name"
        bindValue="id" multiple="true" closeOnSelect="false" placeholder="Select skills">
      </ng-select>
      <div *ngIf="jobForm.get('skills_required')?.invalid && jobForm.get('skills_required')?.touched"
        class="text-danger">
        Skills are required.
      </div>
    </div> -->


    <div class="form-group">
      <label for="date_published">Date Published<span class="text-danger">*</span></label>
      <input 
      id="date_published" 
      formControlName="date_published" 
      type="text" 
      class="form-control" 
      type="date"      
      [readonly]="isDatePublishedReadonly"/>
      <div *ngIf="jobForm.get('date_published')?.invalid && jobForm.get('date_published')?.touched" class="text-danger">
        Date published is required.
      </div>
    </div>

    <div class="form-group">
      <label for="deadline">Deadline<span class="text-danger">*</span></label>
      <input id="deadline" formControlName="deadline" type="date" class="form-control" />
      <div *ngIf="jobForm.get('deadline')?.invalid && jobForm.get('deadline')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('deadline')?.errors?.['required']">deadline is required.</small>
        <small *ngIf="jobForm.get('deadline')?.errors?.['deadlineInvalid']">Deadline cannot be before today's date or the date published.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="short_description">Short Description<span class="text-danger">*</span></label>
      <textarea id="short_description" formControlName="short_description" class="form-control"></textarea>
      <div *ngIf="jobForm.get('short_description')?.invalid && jobForm.get('short_description')?.touched"
        class="text-danger">
        <small *ngIf="jobForm.get('short_description')?.errors?.['required']">short description is required.</small>
        <small *ngIf="jobForm.get('short_description')?.errors?.['minlength']">
          Short Description must be at least {{ jobForm.get('short_description')?.errors?.['minlength'].requiredLength }} characters.</small>
        <small *ngIf="jobForm.get('short_description')?.errors?.['maxlength']">
          Short Description cannot exceed {{ jobForm.get('short_description')?.errors?.['maxlength'].requiredLength }} characters.</small>
          <small *ngIf="jobForm.get('short_description')?.errors?.['minLengthWithoutSpaces']">
            short description must be at least {{ jobForm.get('short_description')?.errors?.['minLengthWithoutSpaces'].requiredLength }} characters excluding spaces.
          </small>
      </div>
    </div>

    <div class="form-group">
      <label for="full_description">Full Description<span class="text-danger">*</span></label>
      <textarea id="full_description" formControlName="full_description" class="form-control"></textarea>
      <div *ngIf="jobForm.get('full_description')?.invalid && jobForm.get('full_description')?.touched"
        class="text-danger">
        <small *ngIf="jobForm.get('full_description')?.errors?.['required']">full description is required.</small>
        <small *ngIf="jobForm.get('full_description')?.errors?.['minlength']">Full Description must be at least {{ jobForm.get('full_description')?.errors?.['minlength'].requiredLength }} characters.</small>
        <small *ngIf="jobForm.get('full_description')?.errors?.['maxlength']">Full Description cannot exceed {{ jobForm.get('full_description')?.errors?.['maxlength'].requiredLength }} characters.</small>
        <small *ngIf="jobForm.get('full_description')?.errors?.['minLengthWithoutSpaces']">
          full description must be at least {{ jobForm.get('full_description')?.errors?.['minLengthWithoutSpaces'].requiredLength }} characters excluding spaces.
        </small>
      </div>
      </div>
    

    <div class="form-group">
      <label for="assignment_duration">Assignment Duration<span class="text-danger">*</span></label>
      <input id="assignment_duration" formControlName="assignment_duration" type="text" class="form-control" />
      <div *ngIf="jobForm.get('assignment_duration')?.invalid && jobForm.get('assignment_duration')?.touched"
        class="text-danger">
        <small *ngIf="jobForm.get('assignment_duration')?.errors?.['required']"> Assignment duration is required.</small>
       
        <small *ngIf="jobForm.get('assignment_duration')?.errors?.['maxlength']">Duration cannot exceed 50 characters.</small>
        <small *ngIf="jobForm.get('assignment_duration')?.errors?.['minLengthWithoutSpaces']">
          assignment duration must be at least {{ jobForm.get('assignment_duration')?.errors?.['minLengthWithoutSpaces'].requiredLength }} characters excluding spaces.
        </small>
      </div>
      <!-- <div *ngIf="jobForm.get('assignment_duration')?.invalid && jobForm.get('assignment_duration')?.touched" class="text-danger">
       
      </div> -->
    </div>

    <div class="form-group">
      <label for="employer">Employer<span class="text-danger">*</span></label>
      <input id="employer" formControlName="employer" type="text" class="form-control" />
      <div *ngIf="jobForm.get('employer')?.invalid && jobForm.get('employer')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('employer')?.errors?.['required']">  Employer is required.</small>
        <small *ngIf="jobForm.get('employer')?.errors?.['maxlength']">Duration cannot exceed 50 characters.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="required_experience">Required Experience<span class="text-danger">*</span></label>
      <input id="required_experience" formControlName="required_experience" type="text" class="form-control" />
      <div *ngIf="jobForm.get('required_experience')?.invalid && jobForm.get('required_experience')?.touched"
        class="text-danger">
        <small *ngIf="jobForm.get('required_experience')?.errors?.['required']">  Experience is required..</small>
        <small *ngIf="jobForm.get('required_experience')?.errors?.['maxlength']">Duration cannot exceed 50 characters.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="start_salary">Start Salary<span class="text-danger">*</span></label>
      <input 
      id="start_salary" 
      formControlName="start_salary" 
      type="text" 
      class="form-control"  
      (input)="formatSalary('start_salary')"/>
      <div *ngIf="jobForm.get('start_salary')?.invalid && jobForm.get('start_salary')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('start_salary')?.errors?.['required']">Start salary is required.</small>
        <small *ngIf="jobForm.get('start_salary')?.errors?.['min']">Start salary cannot be negative.</small>
        <!-- <small *ngIf="jobForm.get('start_salary')?.errors?.['pattern']">Start salary must be a numeric value.</small> -->
        <small *ngIf="jobForm.get('start_salary')?.errors?.['maxlength']">Start salary cannot exceed 7 digits.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="end_salary">End Salary<span class="text-danger">*</span></label>
      <input id="end_salary" formControlName="end_salary" type="text" class="form-control"  (input)="formatSalary('end_salary')" />
      <div *ngIf="jobForm.get('end_salary')?.invalid && jobForm.get('end_salary')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('end_salary')?.errors?.['required']">End salary is required.</small>
        <small *ngIf="jobForm.get('end_salary')?.errors?.['min']">End salary cannot be negative.</small>
        <!-- <small *ngIf="jobForm.get('end_salary')?.errors?.['pattern']">End salary must be a numeric value.</small> -->
        <small *ngIf="jobForm.get('end_salary')?.errors?.['maxlength']">Start salary cannot exceed 8 digits.</small>
      </div>
      <div *ngIf="jobForm.errors?.['salaryMismatch'] && jobForm.get('end_salary')?.touched" class="text-danger">
        Start salary cannot exceed the end salary.
      </div>
    </div>

    <div class="form-group">
      <label for="country_code">Country Code<span class="text-danger">*</span></label>
      <select id="country_code" formControlName="country_code" class="form-control">
        <option value="" disabled>Select a country</option>
        <option *ngFor="let country of countryList" [value]="country.code">
          {{ country.name }} ({{ country.code }})
        </option>
      </select>
      <!-- <div *ngIf="jobForm.get('country_code')?.invalid && jobForm.get('country_code')?.touched" class="text-danger">
          Country Code is required.
        </div> -->
    </div>

    <div class="form-group">
      <label for="address">Address<span class="text-danger">*</span></label>
      <input id="address" formControlName="address" type="text" class="form-control" />
      <!-- <div *ngIf="jobForm.get('address')?.invalid && jobForm.get('address')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('address')?.errors?.['required']"> Address is required.</small>
  
      </div> -->
      <div *ngIf="jobForm.get('address')?.invalid && jobForm.get('address')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('address')?.errors?.['required']">Address is required.</small>
        <small *ngIf="jobForm.get('address')?.errors?.['minlength']">Address must be at least {{ jobForm.get('address')?.errors?.['minlength'].requiredLength }} characters.</small>
        <small *ngIf="jobForm.get('address')?.errors?.['maxlength']">Address cannot exceed {{ jobForm.get('address')?.errors?.['maxlength'].requiredLength }} characters.</small>
        <small *ngIf="jobForm.get('address')?.errors?.['minLengthWithoutSpaces']">
          address must be at least {{ jobForm.get('address')?.errors?.['minLengthWithoutSpaces'].requiredLength }} characters excluding spaces.
        </small>
      </div>
    </div>

    <div class="form-group">
      <label for="application_instructions">Application Instruction<span class="text-danger">*</span></label>
      <textarea id="application_instruction" formControlName="application_instruction" type="text" class="form-control" ></textarea>
      <div *ngIf="jobForm.get('application_instruction')?.invalid && jobForm.get('application_instruction')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('application_instruction')?.errors?.['required']">Application Instruction is required.</small>
        <small *ngIf="jobForm.get('application_instruction')?.errors?.['minlength']">Application Instruction must be at least {{ jobForm.get('address')?.errors?.['minlength'].requiredLength }} characters.</small>
        <small *ngIf="jobForm.get('application_instruction')?.errors?.['maxlength']">Application Instruction cannot exceed {{ jobForm.get('address')?.errors?.['maxlength'].requiredLength }} characters.</small>
        <small *ngIf="jobForm.get('application_instruction')?.errors?.['minLengthWithoutSpaces']">
          application instruction must be at least {{ jobForm.get('application_instruction')?.errors?.['minLengthWithoutSpaces'].requiredLength }} characters excluding spaces.
        </small>
      </div>
    </div>

    <!-- <div class="form-group">
      <label for="file_path"> Document File</label>
      <input
        id="file_path"
        type="file"
        class="form-control"
        (change)="onFileSelected($event, 'file_path')"
      />
      <div *ngIf="jobForm.get('file_path')?.invalid && jobForm.get('file_path')?.touched" class="text-danger">
        File Path is required.
      </div>
    </div> -->

    <div class="form-group">
      <label for="featured_image">Featured Image<span class="text-danger">*</span></label>
      <input id="featured_image" type="file" class="form-control" (change)="onFileSelected($event, 'featured_image')" />
      <div *ngIf="jobForm.get('featured_image')?.value">
        <img [src]="jobForm.get('featured_image')?.value" alt="Featured Image" class="img-preview" width="200" />
      </div>
      <!-- <div *ngIf=" jobForm.get('featured_image')?.value == null">
        <img src="assets/images/noimage.webp" alt="No Image" class="img-preview" width="200" />
      </div> -->
      <div *ngIf="jobForm.get('featured_image')?.invalid && jobForm.get('featured_image')?.touched" class="text-danger">
        Featured image is required.
      </div>
    </div>
    <div class="form-group">
      <label for="social_media_type">Social Media Type<span class="text-danger">*</span></label>
      <ng-select
        [items]="socialMediaOptions"
        [multiple]="true"
        bindLabel="label"
        bindValue="value"
        formControlName="social_media_type"
        placeholder="Select platforms"
        [disabled]="isEditMode"
        class="form-control">
      </ng-select>
      <div *ngIf="jobForm.get('social_media_type')?.invalid && jobForm.get('social_media_type')?.touched" class="text-danger">
        Social Media Type is required.
      </div>
    </div>
    
    <!-- <div class="form-group">
      <label for="social_media_type">Social Media Type<span class="text-danger">*</span></label>
      <select id="social_media_type" formControlName="social_media_type" class="form-control">
        <option value="" disabled>Select a platform</option>
        <option value="facebook">Facebook</option>
        <option value="linkedin">LinkedIn</option>
      
      </select>
      <div *ngIf="jobForm.get('social_media_type')?.invalid && jobForm.get('social_media_type')?.touched" class="text-danger">
        Social Media Type is required.
      </div>
    </div> -->
    <div class="form-group">
      <label for="job_type_post">Type of post<span class="text-danger">*</span></label>
      <select id="job_type_post" formControlName="job_type_post" class="form-control"  [disabled]="isEditMode">
        <option value="" disabled>Select a post</option>
        <option value="postnow">Post now</option>
        <option value="schedulelater">Schedule later</option>
      
      </select>
      <div *ngIf="jobForm.get('job_type_post')?.invalid && jobForm.get('job_type_post')?.touched" class="text-danger">
        jobposting is required.
      </div>
    </div>
    
   
    <div class="form-group" *ngIf="jobForm.get('job_type_post')?.value === 'schedulelater'">
      <label for="posted_at">Post At<span class="text-danger">*</span></label>
      <input id="posted_at" formControlName="posted_at" type="datetime-local" class="form-control" />
      <div *ngIf="jobForm.get('posted_at')?.invalid && jobForm.get('posted_at')?.touched" class="text-danger">
        <small *ngIf="jobForm.get('posted_at')?.errors?.['required']">Post At is required.</small>
        <small *ngIf="jobForm.get('posted_at')?.errors?.['pastDateTime']">Post At cannot be in the past.</small>
        <small *ngIf="jobForm.get('posted_at')?.errors?.['minimumTime']">Please select a time at least 1 hour from now.</small>
      </div>
    </div>
    
    

    <button type="submit" class="btn btn-primary" 
      [disabled]="(!isEditMode && !jobForm.valid )">
      {{ isEditMode ? 'Update' : 'Create' }} jobposting
    </button>
  </form>
</div>